// html
<button class="btn btn-danger" id="record">
    <div class="icon">
        <ion-icon name="mic-outline"></ion-icon>
    </div>
</button>


// ë§ˆì´í¬ ì´ëª¨í‹°ì½˜ 
<script type="module"src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
<script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>


// ìë°”ìŠ¤í¬ë¦½íŠ¸ ì˜¨ë¡œë“œ ë¶€ë¶„
// ìŒì„± ì¸ì‹ ê¸°ëŠ¥
    // ì±„íŒ…ë°© ì„¤ì • ì–¸ì–´ë¡œ ìŒì„±ì„ ì¸ì‹í•´ì„œ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜ í›„
    // ë‚´ ì±„íŒ…ìœ¼ë¡œ ì¶”ê°€í•œë‹¤.
     // ğŸ”¥record buttonì˜ˆìœ ë²„ì ¼ í…ŒìŠ¤íŠ¸
    let recording = false;
    const recordBtn = document.getElementById("record");


    if(!("webkitSpeechRecognition" in window)){
        alert("ë§ˆì´í¬ ê¸°ëŠ¥ì€ í¬ë¡¬ ë¸Œë¼ìš°ì €ì—ì„œë§Œ ì§€ì›ë©ë‹ˆë‹¤.");
    }else{
        try{
            const speech = new webkitSpeechRecognition;
            speech.lang = room_language;  // room_languageë¡œ ëŒ€ì²´

            // start ëˆŒë €ì„ë•Œ
            recordBtn.addEventListener("click", () => {
                console.log("ìŒì„±ì¸ì‹ ë²„íŠ¼ ëˆŒë¦¼"); // í…ŒìŠ¤íŠ¸
                if (!recording) {
                    speech.start();
                    console.log('ìŒì„±ì¸ì‹ ì‹œì‘');
                    recording = true;
                } else {
                // stop ëˆŒë €ì„ë•Œ
                    speech.stop();
                    recording = false;
                    console.log('ìŒì„±ì¸ì‹ ì¤‘ì§€');
                    // ìŒì„±ì¸ì‹ ê²°ê³¼ ì¶œë ¥
                    speech.addEventListener("result", (event) =>{
                        const speechResult = event.results[0][0].transcript;
                        console.log(speechResult);
                        // ìŒì„±ì¸ì‹ ê²°ê³¼ë¥¼ ì±„íŒ… UIì— ë©”ì„¸ì§€ë¡œ ì¶”ê°€
                        // isMe = true (ë‚´ ë°œí™”)
                        addMessage(speechResult, true); // í™”ë©´ì— ì¶”ê°€
                        // ğŸ”¥ë©”ì„¸ì§€ ì„œë²„ì— ì „ë‹¬
                        ws.send(JSON.stringify({ type: "user-message", message: speechResult }));
                     });
                }
            });
                
            // ì—ëŸ¬ ì²˜ë¦¬
            speech.onerror = (event) => {
                stopRecording();  // ë…¹ìŒ ì¤‘ì§€

                if (event.error === "no-speech") {
                    alert("No speech was detected. Stopping...");
                } else if (event.error === "audio-capture") {
                    alert(
                    "ë°œê²¬ëœ ë§ˆì´í¬ê°€ ì—†ìŠµë‹ˆë‹¤."
                    );
                } else if (event.error === "not-allowed") {
                    alert("ë§ˆì´í¬ ì‚¬ìš©ì„ í—ˆê°€í•´ì£¼ì‹­ì‹œì˜¤.");
                } else if (event.error === "aborted") {
                    alert("Listening Stopped.");
                } else {
                    alert("ì¸ì‹ ì¤‘ ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: " + event.error);
                }   
            }; 
            } catch (error) {
                recording = false;
                console.log(error);
            }
        }